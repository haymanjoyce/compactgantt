Finish-to-Start (FS) Dependency Link Rendering Rules
======================================================

Connection Points
-----------------

Regular Tasks (Rectangular Bars):
- From (Origin): Right edge of predecessor task bar, vertical midpoint
- To (Termination): Left edge of successor task bar, vertical midpoint

Milestones (Diamond Shape):
- From (Origin): Center point of predecessor milestone diamond (center_x, center_y)
- To (Termination): Center point of successor milestone diamond (center_x, center_y)

Mixed Cases (Task ↔ Milestone):
- Task → Milestone: Right edge of task bar to center of milestone diamond
- Milestone → Task: Center of milestone diamond to left edge of task bar

Arrowhead: Tip at termination point, oriented along the final path segment direction 
(downward for successor below, upward for successor above, leftward for horizontal).

Definitions
-----------

- Same Row: Predecessor and successor in same row (row_num matches)
- Same Date: Predecessor finish date equals successor start date (x-coordinates align within 1 pixel)
- Gap/Lag: Successor start date is after predecessor finish date (positive horizontal separation)
- No Gap: Successor start date equals predecessor finish date (x-coordinates align)
- Row Midpoint Y: (predecessor_y_center + successor_y_center) / 2

Rendering Cases
---------------

1. Same Row Cases

1a. No Gap (Bars Touch or Nearly Touch)
- Condition: Same row AND same date (x-coordinates align within 1 pixel)
- Rendering: 
  - If points coincide or very close (< 5 pixels): Minimal horizontal extension (5-10 pixels) rightward, then arrowhead
  - Otherwise: Straight horizontal line from origin to termination
- Path: Single horizontal segment: (origin_x, origin_y) → (term_x, term_y)

1b. Positive Gap/Lag (Bars Separated)
- Condition: Same row AND successor start x > predecessor finish x
- Rendering: Straight horizontal line from origin to termination
- Path: Single horizontal segment: (origin_x, origin_y) → (term_x, term_y)

2. Successor Below Predecessor Cases

2a. No Gap (Aligned Vertically)
- Condition: Different rows (successor below) AND same date (x-coordinates align within 1 pixel)
- Rendering: 
  - If |origin_x - term_x| < 2px: Single vertical segment (collapse tiny horizontal stubs for milestones)
  - Otherwise: V-H-V pattern with segments as small as 0px
- Path: (origin_x, origin_y) → (term_x, term_y) or (origin_x, origin_y) → (origin_x, mid_y) → (term_x, mid_y) → (term_x, term_y)

2b. Positive Gap/Lag (Successor Starts Later)
- Condition: Different rows (successor below) AND successor start x > predecessor finish x
- Rendering: V-H-V pattern:
  - Segment 1: Vertical down from origin to row midpoint y
  - Segment 2: Horizontal right to align with successor start x (or center_x for milestones)
  - Segment 3: Vertical down to termination point
- Path: (origin_x, origin_y) → (origin_x, mid_y) → (term_x, mid_y) → (term_x, term_y)

3. Successor Above Predecessor Cases

3a. No Gap (Aligned Vertically)
- Condition: Different rows (successor above) AND same date (x-coordinates align within 1 pixel)
- Rendering: 
  - If |origin_x - term_x| < 2px: Single vertical segment (collapse tiny horizontal stubs for milestones)
  - Otherwise: V-H-V pattern with segments as small as 0px
- Path: (origin_x, origin_y) → (term_x, term_y) or (origin_x, origin_y) → (origin_x, mid_y) → (term_x, mid_y) → (term_x, term_y)

3b. Positive Gap/Lag (Successor Starts Later)
- Condition: Different rows (successor above) AND successor start x > predecessor finish x
- Rendering: V-H-V pattern:
  - Segment 1: Vertical up from origin to row midpoint y
  - Segment 2: Horizontal right to align with successor start x (or center_x for milestones)
  - Segment 3: Vertical up to termination point
- Path: (origin_x, origin_y) → (origin_x, mid_y) → (term_x, mid_y) → (term_x, term_y)

Additional Specifications
--------------------------

Line Styling:
- Color: Black (configurable)
- Width: 1.5 pixels (configurable)
- Style: Solid

Arrowhead:
- Size: 5 pixels (base width, configurable)
- Direction: Oriented along the final path segment direction
- Position: Tip at termination point (left edge for tasks, center for milestones)
- Fill: Black, solid

Milestone Handling:
- Connection Point: Always use geometric center (center_x, center_y)
- Perfect Alignment Override: If |origin_x - term_x| < 2px for different-row no-gap cases, 
  collapse to single vertical segment instead of V-H-V (avoids tiny horizontal stubs)

Edge Cases:
- Overlapping Tasks: Invalid FS relationships do not render (handled by "Valid" field)
- Very Close Tasks: If horizontal distance < 5 pixels, apply minimum 5-10 pixel offset for visibility
- Same Position: If origin and termination coincide exactly, extend 10 pixels rightward before arrowhead
- Multiple Links: Each link renders independently

Implementation Notes:
- Check is_milestone flag for both predecessor and successor
- For milestones, use center_x instead of x_end/x_start edges
- For regular tasks, use x_end (predecessor) and x_start (successor)
- V-H-V Pattern: Always use exact row midpoint y for horizontal segment
- Arrowhead Orientation: Calculate based on final segment direction (down/up/left)

